# 要件定義書

## 概要

この文書は、患者がオンラインで予約を取り、予約を管理でき、クリニックスタッフがスケジュールと患者の予約を管理できるクリニック予約システムの要件を定義します。患者とクリニック管理者の両方にとって使いやすいインターフェースを提供する必要があります。

## 要件

### 要件 1

**ユーザーストーリー:** 患者として、利用可能な予約枠を確認したいので、医療相談に便利な時間を予約できるようにしたい。

#### 受入基準

1. 患者が予約システムにアクセスした時、システムは今後30日間の利用可能な時間枠を表示する
2. 患者が特定の日付を選択した時、システムはその日の利用可能な予約時間をすべて表示する
3. 選択した日付に予約が取れない時、システムは利用不可を示すメッセージを表示する
4. 時間枠が既に予約済みの場合、システムはそれを利用可能として表示してはならない

### 要件 2

**ユーザーストーリー:** 患者として、個人情報を提供して予約を取りたいので、クリニックが私の来院に備えることができるようにしたい。

#### 受入基準

1. 患者が利用可能な時間枠を選択した時、システムは患者情報（氏名、電話番号、メールアドレス、来院理由）の入力を求める
2. 患者が予約情報を送信した時、システムは必須フィールドがすべて入力されているかを検証する
3. 予約情報が有効な時、システムは予約を作成し確認を送信する
4. 必須情報が不足している場合、システムは未入力フィールドのエラーメッセージを表示する
5. 予約が正常に完了した時、システムは患者に確認メールを送信する

### 要件 3

**ユーザーストーリー:** 患者として、予約をキャンセルまたは変更したいので、スケジュールの変更に対応できるようにしたい。

#### 受入基準

1. 患者が予約番号を提供した時、システムは予約詳細を表示する
2. 患者がキャンセルを要求した時、システムは予約をキャンセルし確認を送信する
3. 患者が変更を要求した時、システムは利用可能な代替時間枠を表示する
4. 予約の24時間前以内にキャンセルが要求された場合、システムは警告メッセージを表示する
5. 変更が完了した時、システムは更新された予約確認を送信する

### 要件 4

**ユーザーストーリー:** クリニックスタッフとして、予約スケジュールを管理したいので、利用可能性をコントロールし患者の予約を効率的に処理できるようにしたい。

#### 受入基準

1. スタッフが管理パネルにログインした時、システムは日次予約スケジュールを表示する
2. スタッフが新しい予約を追加した時、システムはスケジュールを更新し時間枠を利用不可にする
3. スタッフが予約をキャンセルした時、システムは時間枠を新規予約用に開放する
4. スタッフが患者詳細を確認した時、システムは完全な予約情報を表示する
5. スタッフが時間枠の重複予約を試みた場合、システムは操作を防止しエラーを表示する

### 要件 5

**ユーザーストーリー:** クリニックスタッフとして、詳細なスケジュール設定を行いたいので、クリニックの運営に合わせて柔軟な予約枠を提供できるようにしたい。

#### 受入基準

1. スタッフが基本営業時間を設定した時、システムは曜日別の営業時間を個別に設定できる
2. スタッフが医師別スケジュールを設定した時、システムは医師ごとの勤務時間と専門診療時間を管理する
3. スタッフが診療科目別時間を設定した時、システムは診療内容に応じた予約時間枠（15分、30分、60分など）を設定できる
4. スタッフが特別営業日を設定した時、システムは祝日でも営業する日や臨時休診日を個別に管理する
5. スタッフが予約間隔を設定した時、システムは診療準備時間や清掃時間を考慮した間隔を設定できる
6. スタッフが予約上限を設定した時、システムは時間帯別・医師別・診療科目別の予約数上限を管理する
7. スタッフが緊急枠を設定した時、システムは急患対応用の予約枠を確保し管理者のみが使用できるようにする
8. スタッフが季節営業を設定した時、システムは期間限定の営業時間変更や特別診療スケジュールを管理する
9. スタッフがブロック時間を設定した時、システムは会議や研修などで予約を受け付けない時間帯を設定できる
10. スタッフが予約開始日を設定した時、システムは何日先まで予約を受け付けるかを診療科目別に設定できる

### 要件 6

**ユーザーストーリー:** 患者として、予約リマインダーを受け取りたいので、予定された来院を忘れないようにしたい。

#### 受入基準

1. 予約の24時間前になった時、システムは患者にメールリマインダーを送信する
2. 予約の2時間前になった時、電話番号が提供されている場合システムはSMSリマインダーを送信する
3. 患者がリマインダーを拒否した時、システムはリマインダー通知を送信しない
4. リマインダー配信が失敗した場合、システムはスタッフ確認用に失敗をログに記録する

### 要件 7

**ユーザーストーリー:** 患者として、LINEから予約を取りたいので、普段使っているアプリから簡単に予約できるようにしたい。

#### 受入基準

1. 患者がLINE公式アカウントにメッセージを送信した時、システムは予約メニューを表示する
2. 患者がLINEで予約を選択した時、システムは利用可能な時間枠を表示する
3. 患者がLINEで予約を完了した時、システムは確認メッセージをLINEで送信する
4. 患者がLINEで予約変更・キャンセルを要求した時、システムは対応する機能を提供する
5. LINEでの予約情報は、Webシステムの予約と同期される

### 要件 8

**ユーザーストーリー:** 患者として、美容機器などの連続治療の予約を一度に取りたいので、複数回の通院スケジュールを効率的に管理できるようにしたい。

#### 受入基準

1. 患者が連続予約を選択した時、システムは治療回数と間隔の設定を求める
2. 患者が連続予約の条件を設定した時、システムは利用可能な連続スロットを表示する
3. 患者が連続予約を確定した時、システムは全ての予約を一括で作成する
4. 連続予約の一部をキャンセル・変更する時、システムは他の予約への影響を表示する
5. 連続予約が完了した時、システムは次回の予約推奨日を提案する

### 要件 9

**ユーザーストーリー:** 患者として、家族の予約を一緒に管理したいので、家族全員の予約を一つのアカウントで取れるようにしたい。

#### 受入基準

1. 患者が家族アカウントを作成した時、システムは家族メンバーの登録を求める
2. 患者が家族の予約を取る時、システムは家族メンバーを選択できるようにする
3. 患者が家族の予約を確認した時、システムは家族全員の予約スケジュールを表示する
4. 家族の予約をキャンセル・変更する時、システムは適切な権限確認を行う
5. 家族予約の通知は、登録された連絡先に適切に送信される

### 要件 10

**ユーザーストーリー:** 患者として、予約時に簡単な問診に回答したいので、来院時の診察がスムーズに進むようにしたい。

#### 受入基準

1. 患者が予約を取る時、システムは症状に応じた問診フォームを表示する
2. 患者が問診に回答した時、システムは回答内容を検証し保存する
3. 患者が問診を完了した時、システムは医師が確認できるよう情報を整理する
4. 問診内容に緊急性がある場合、システムは適切な警告を表示する
5. 問診履歴は、患者の診療記録として蓄積される

### 要件 11

**ユーザーストーリー:** クリニックスタッフとして、患者の初診・再診を管理したいので、適切な診療時間と料金を設定できるようにしたい。

#### 受入基準

1. 患者が初回予約を取る時、システムは初診として分類し長めの時間枠を確保する
2. 患者が再度予約を取る時、システムは再診として分類し標準時間枠を設定する
3. スタッフが患者情報を確認した時、システムは初診・再診の履歴を表示する
4. 初診患者の予約時、システムは必要な書類や準備事項を案内する
5. 診療区分に応じて、システムは適切な料金情報を表示する

### 要件 12

**ユーザーストーリー:** 患者として、オンライン診療の予約を取りたいので、来院せずに医師の診察を受けられるようにしたい。

#### 受入基準

1. 患者がオンライン診療を選択した時、システムは対応可能な医師と時間を表示する
2. 患者がオンライン診療を予約した時、システムはビデオ通話のリンクを生成する
3. オンライン診療の開始時間になった時、システムは患者と医師に通知を送信する
4. オンライン診療中、システムは安全な通信環境を提供する
5. オンライン診療後、システムは診療記録を保存し処方箋発行機能を提供する

### 要件 13

**ユーザーストーリー:** クリニックスタッフとして、予約統計のレポートを生成したいので、クリニックの利用状況と患者パターンを分析できるようにしたい。

#### 受入基準

1. スタッフが日次レポートを要求した時、システムは予約数、キャンセル数、無断欠席数を表示する
2. スタッフが月次レポートを要求した時、システムは予約傾向とピーク時間を表示する
3. スタッフがレポートデータをエクスポートした時、システムはダウンロード可能なCSVまたはPDF形式を生成する
4. 選択期間にデータが存在しない場合、システムは適切なメッセージを表示する
5. レポートには初診・再診、オンライン・対面診療の区分別統計を含む

### 要件 14

**ユーザーストーリー:** 患者として、予約時に支払い方法を選択し決済したいので、診療費用の支払いをスムーズに行えるようにしたい。

#### 受入基準

1. 患者が予約確定前に、システムは支払い方法（クレジットカード、銀行振込、現金）を選択できるようにする
2. オンライン決済を選択した場合、システムは安全な決済処理を実行し領収書を発行する
3. 予約キャンセル時、システムはキャンセルポリシーに基づいて返金処理を自動実行する
4. 保険診療の場合、システムは自己負担額を自動計算し表示する
5. 決済履歴は患者のマイページで確認可能とする

### 要件 15

**ユーザーストーリー:** 患者として、キャンセルポリシーを理解した上で予約したいので、キャンセル時の料金や条件を事前に確認できるようにしたい。

#### 受入基準

1. 予約作成時、システムはキャンセルポリシーを明確に表示し同意を求める
2. 24時間前以降のキャンセルは50%、当日キャンセルは100%のキャンセル料を設定可能とする
3. 無断キャンセルが3回以上の場合、システムは次回予約時に事前決済を要求する
4. 医療上の緊急事態によるキャンセルは、システムは料金免除の申請機能を提供する
5. キャンセル料金の請求と支払い状況は管理画面で確認可能とする

### 要件 16

**ユーザーストーリー:** 患者として、保険証情報を登録し保険診療を受けたいので、保険適用の手続きをオンラインで完了できるようにしたい。

#### 受入基準

1. 患者が初回登録時、システムは保険証情報の入力と画像アップロードを求める
2. 保険証の有効期限が近づいた時、システムは更新を促す通知を送信する
3. 保険診療対象の治療を選択した時、システムは自己負担額を自動計算して表示する
4. 保険証確認が必要な場合、システムはスタッフに通知し確認フローを提供する
5. 保険請求に必要な情報は、システムが自動的に収集・整理する

### 要件 17

**ユーザーストーリー:** 患者として、待ち時間を確認したいので、来院前に現在の混雑状況を把握できるようにしたい。

#### 受入基準

1. 患者が予約詳細を確認した時、システムはリアルタイムの待ち時間予測を表示する
2. 診療が遅延している場合、システムは自動的に患者に通知を送信する
3. 患者が待ち時間通知を設定した時、システムは順番が近づいたら通知する
4. スタッフが診療進捗を更新した時、システムは待ち時間予測を自動再計算する
5. 過去の待ち時間データから、システムは時間帯別の混雑予測を表示する

### 要件 18

**ユーザーストーリー:** 外国人患者として、母国語で予約システムを利用したいので、言語を切り替えて使用できるようにしたい。

#### 受入基準

1. システムは日本語、英語、中国語、韓国語の最低4言語に対応する
2. 患者が言語を選択した時、システムは全ての画面表示を選択言語に切り替える
3. 予約確認メールやSMS通知も、患者が選択した言語で送信される
4. 問診フォームは多言語対応し、回答も選択言語で入力可能とする
5. スタッフ画面では、患者の選択言語と入力内容の日本語翻訳を並列表示する

### 要件 19

**ユーザーストーリー:** 視覚障害を持つ患者として、スクリーンリーダーで予約システムを利用したいので、アクセシビリティに配慮した設計にしてほしい。

#### 受入基準

1. システムは WCAG 2.1 レベル AA の基準を満たす
2. すべての画像とアイコンに適切な代替テキストを設定する
3. キーボードのみで全ての操作が可能とする
4. フォーカス順序は論理的で、視覚的に明確に表示される
5. エラーメッセージは具体的で、修正方法を明示する
6. 色のコントラスト比は最低基準を満たし、色だけに依存しない情報提供を行う

### 要件 20

**ユーザーストーリー:** クリニックスタッフとして、既存の電子カルテシステムと連携したいので、患者情報や診療記録を一元管理できるようにしたい。

#### 受入基準

1. システムは主要な電子カルテシステム（ORCA、Medicom等）とAPI連携する
2. 予約作成時、患者IDで電子カルテから基本情報を自動取得する
3. 診療完了後、予約情報と診療内容を電子カルテに自動送信する
4. 問診回答データは構造化されたフォーマットで電子カルテに連携する
5. 連携エラー時は、手動での情報入力とリトライ機能を提供する

### 要件 21

**ユーザーストーリー:** クリニック経営者として、システムのパフォーマンスを監視したいので、応答速度や稼働率を確認できるようにしたい。

#### 受入基準

1. API応答時間は95パーセンタイルで200ms以下を維持する
2. システム稼働率は99.9%以上（月間ダウンタイム43分以内）を保証する
3. 同時接続数は最低1000ユーザーをサポートする
4. ページロード時間は3秒以内を目標とする
5. パフォーマンス低下時は自動アラートを管理者に送信する